<div class="container py-4 mt-5">
  <h2 class="text-center pt-5 text-shadow-view" data-aos="fade-down" data-aos-duration="800">Welcome to user dashboard</h2>
  <h5 class="text-primary text-center text-shadow" data-aos="fade-up" data-aos-duration="800" data-aos-delay="150">You can select any batch from here and view their details</h5>

  <!-- <h3 class="mb-3 text-primary text-shadow" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="300">All Batches</h3><hr/> -->
   <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
    <!-- Left side: Title -->
    <h3 class="text-primary text-shadow mb-2 mb-md-0" data-aos="zoom-in" data-aos-duration="800" data-aos-delay="300">
      All Batches
    </h3>

    <!-- Right side: Search Input -->
    <div class="search-box" data-aos="fade-left" data-aos-duration="800" data-aos-delay="400">
      <input 
        type="text" 
        class="form-control form-control-sm" 
        placeholder="Search batch by name..." 
        [(ngModel)]="searchTerm" 
        (input)="filterBatches()"
        style="min-width: 230px;"
      />
    </div>
  </div>
  <hr />


  <!-- Loader -->
  <div *ngIf="loading" class="text-center">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Loading batches...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage && !loading" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Same card design for all screens -->
  <div *ngIf="!loading" class="row shadow overflow-hidden">
    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-3 shadow" *ngFor="let batch of filteredBatches.length ? filteredBatches : batches; let i = index" [attr.data-aos]="getAosEffect(i)" [attr.data-aos-delay]="getAosDelay(i)">
      <div class="card shadow-lg h-100" [ngClass]="batch.status === 'Completed' ? 'border-secondary' : 'border-white'">
        <div class="card-body">
          <h6 class="card-title text-danger" [ngClass]="batch.status === 'Completed' ? 'text-secondary' : 'text-danger'">Batch #{{ i + 1 }}</h6>
          <p><strong class="text-primary">Name:</strong> {{ batch.name }}</p>
          <p><strong class="text-primary">Description:</strong> {{ batch.description }}</p>
          <p>
            <strong class="text-primary">Status: &nbsp;</strong>
            <span *ngIf="batch.status === 'Active'" class="badge bg-success">Active</span>
            <span *ngIf="batch.status === 'Completed'" class="badge bg-secondary">Completed</span>
          </p>
          <p><strong class="text-primary">Start Date:</strong> <span class="text-success"> {{ batch.startDate | date: 'mediumDate' }}</span></p>
          <!-- Show End Date only if Completed -->
          <p *ngIf="batch.endDate"><strong class="text-primary">End Date:</strong> <span class="text-danger"> {{ batch.endDate | date: 'mediumDate' }}</span></p>
          <p><strong class="text-primary">Created At:</strong> {{ batch.createAt | date: 'medium' }}</p>
          <p><strong class="text-primary">Batch ID:</strong> {{ batch._id | slice:0:8 }}</p>
          <p><strong class="text-primary">User ID:</strong> {{ batch.userId | slice:0:8 }}</p>
        </div>
        <div class="card-footer bg-white border-0 text-center">
          <button class="btn btn-sm btn-primary w-100" (click)="selectedBatch(batch._id)" [disabled]="batchLoading[batch._id]">
            <ng-container *ngIf="batchLoading[batch._id]; else selectText">
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Loading...
            </ng-container>
            <ng-template #selectText>
              Select
            </ng-template>
          </button>
          <!-- Completed message -->
          <div *ngIf="batch.status === 'Completed'" class="mt-2 text-secondary fw-bold small">
            Batch has ended
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
<!-- Purchases for selected batch -->
<!-- <div *ngIf="purchases.length > 0 && !batchLoading" class="mt-4">
  <h4 class="text-success">Purchases for Batch {{ selectedBatchId | slice:0:8 }}</h4>
  <ul class="list-group">
    <li *ngFor="let purchase of purchases" class="list-group-item">
      <strong>Quantity:</strong> {{ purchase.quantity }} <br>
      <strong>Price:</strong> ₦{{ purchase.price }} <br>
      <strong>Price/Chick:</strong> ₦{{ purchase.pricePerChick }} <br>
      <strong>Date:</strong> {{ purchase.dateOfPurchaseFormatted }}
    </li>
  </ul>
</div> -->


<app-footer></app-footer>